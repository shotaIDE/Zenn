---
title: "Firebase Remote Configを利用してフィーチャーフラグを実現する際に必要な知識"
emoji: "📡"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["firebase", "ios", "android"]
published: false
---

# Firebase Remote Config とは

アプリのアップデートをストアから公開しなくても、アプリの動作を変更できるようにする仕組みです。

# 実現できること

以下が実現できるようになります。

- 特定の機能の ON/OFF を、アプリのアップデートなしに切り替える
- 特定の機能を、パーセンテージロールアウトで徐々にリリースする
- 特定の機能を、特定の端末のみ、ON/OFF を切り替えて試験する

# 利用前の事前準備

## サーバー

Web ページから Firebase のプロジェクトを作成し、Remote Config の画面でキー＆バリューを記述します。

## モバイルアプリ

Firebase Remote Config のライブラリを依存関係に追加します。

# 実装・運用の概要

1 つの機能に Firebase Remote Config によるフィーチャートグルを適用する流れは以下のようになります。

1. リモート設定のキー・バリューを設計する
2. モバイルアプリ側で、リモート設定の同期処理と、定義されたキー・バリューを元に条件分岐を実装する
3. テスト環境の Firebase プロジェクト内で、Remote Config のキー・バリューを変更しながらテストする
4. モバイルアプリをストアからリリースする
5. 商用環境の Firebase プロジェクト内で、Remote Config のキー・バリューを変更して、機能を一般公開する

以下は必要に応じて行う手順です。

6. 機能の一般公開に問題ないことが確認できたら、モバイルアプリ側で条件分岐を削除して機能 ON 固定状態とした上で、モバイルアプリをストアからリリースする
7. モバイルアプリの強制アップデートなどにより、キー・バリューを利用するアプリが存在しなくなったあとに、Firebase プロジェクト内で Remote Config のキー・バリューを削除する

# 実装と運用の詳細

## サーバー

リモート設定のキー・バリューを設計し、それを Remote Config の Web 画面で設定します。

1 つのキーには条件に応じたバリューを複数設定できるため、設計時には条件とバリューのセットを考慮しておく必要があります。
モバイルアプリ側では、条件に合致したバリューが 1 つだけ取得されます。

![](/images/firebase-remote-config/value-conditions.png)

## モバイルアプリ

モバイルアプリ側では、リモート設定の値に応じてプログラム中に分岐を書き、フィーチャートグル ON の時の挙動と OFF の時の挙動を両方定義します。

```swift
let isFeatureAEnabled = RemoteConfig.remoteConfig.configValue(forKey: "featureA").boolValue
if isFeatureAEnabled {
    // 機能A のフィーチャートグル ON の時の挙動
} else {
    // 機能A のフィーチャートグル OFF の時の挙動
}
```

リモート設定がサーバーから 1 回も同期できていない場合は、モバイルアプリ側で定義してあるデフォルトの設定値を使用します。

また、リモート設定のサーバーからの同期は、アプリがフォアグラウンド状態の場合に数秒以内のタイムラグを含みつつリアルタイムで行われます。
アプリがバックグラウンド状態でサーバー側のリモート設定が変更された場合は、アプリがフォアグラウンド状態へ遷移した直後、数秒以内にリモート設定の同期が行われます。
